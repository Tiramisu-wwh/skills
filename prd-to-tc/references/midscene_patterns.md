# Midscene UI自动化测试模式总结

基于项目内`Midscene编写提示词（指令）的技巧.md`的最佳实践总结。

## 核心原则

### 1. 一个Prompt只做一件事
避免在单个指令中包含多个操作，提高稳定性和可维护性。

❌ 错误示例：
```javascript
await ai('点击登录按钮，然后输入用户名，最后点击提交');
```

✅ 正确示例：
```javascript
await ai('点击登录按钮');
await ai('在用户名输入框中输入"testuser"');
await ai('点击提交按钮');
```

### 2. 提供详细描述和示例
使用具体的UI元素描述，提高定位准确性。

❌ 错误示例：
```javascript
await ai('点击按钮');
```

✅ 正确示例：
```javascript
await ai('点击页面右上角的"登录"按钮，它是一个蓝色背景的按钮');
```

### 3. 使用即时操作接口
对于简单操作，使用特定的即时操作方法提高效率和准确性。

```javascript
// 推荐：使用即时操作接口
await aiTap('登录按钮');
await aiType('用户名输入框', 'testuser');

// 避免：使用通用AI规划
await ai('点击登录按钮并输入用户名');
```

## 常用测试模式

### 登录功能测试
```javascript
// 登录测试模板
await ai('在登录页面的用户名输入框中输入"testuser"');
await ai('在密码输入框中输入"password123"');
await aiTap('登录按钮');
await ai('验证页面跳转到系统主页');
await ai('验证右上角显示用户名"testuser"');
```

### 搜索功能测试
```javascript
// 搜索测试模板
await ai('在页面顶部的搜索框中输入"耳机"');
await aiTap('搜索按钮');
await ai('验证搜索结果页面正常显示');
await ai('验证搜索结果包含耳机相关产品');
await ai('验证搜索结果的排序和分页功能');
```

### 表单提交测试
```javascript
// 表单提交模板
await ai('在用户名字段中输入"张三"');
await ai('在邮箱字段中输入"zhangsan@example.com"');
await ai('在电话字段中输入"13800138000"');
await ai('勾选同意服务条款复选框');
await aiTap('提交按钮');
await ai('验证显示"提交成功"的提示信息');
await ai('验证表单数据正确保存');
```

### 列表操作测试
```javascript
// 列表操作模板
await ai('验证产品列表正常显示');
await ai('检查每个列表项包含产品名称和价格');
await ai('点击第一个产品的详情链接');
await ai('验证进入产品详情页面');
await ai('验证详情页面显示完整的产品信息');
```

### 导航测试
```javascript
// 页面导航模板
await ai('点击主导航菜单中的"产品"选项');
await ai('验证页面跳转到产品列表页面');
await ai('验证当前页面的面包屑显示"首页 > 产品"');
await ai('验证产品分类侧边栏正常显示');
```

## 元素定位技巧

### 使用空间位置信息
```javascript
// 明确元素位置关系
await ai('点击页面右上角的用户头像');
await ai('在表单底部的提交按钮');
await ai('选择导航栏中间的"设置"选项');
```

### 使用视觉特征描述
```javascript
// 描述元素的视觉特征
await ai('点击红色的"删除"按钮');
await ai('在带加号图标的"添加"按钮');
await ai('找到星标图标的收藏按钮');
```

### 使用上下文信息
```javascript
// 利用周围元素定位
await ai('在用户名输入框下方的"忘记密码"链接');
await ai('产品价格右侧的"立即购买"按钮');
await ai('表格最后一行的操作列中的"编辑"链接');
```

## 断言验证模式

### 内容验证
```javascript
// 验证文本内容
await ai('验证页面标题显示"用户登录"');
await ai('验证错误提示信息显示"用户名或密码错误"');
await ai('验证成功消息显示"操作完成"');
```

### 状态验证
```javascript
// 验证元素状态
await ai('验证登录按钮处于可点击状态');
await ai('验证加载动画正在显示');
await ai('验证错误信息高亮显示为红色');
```

### 数量验证
```javascript
// 验证数量和列表
await ai('验证搜索结果列表显示10个项目');
await ai('验证购物车图标显示数量为3');
await ai('验证错误消息只显示一条');
```

### 存在性验证
```javascript
// 验证元素存在或不存在
await ai('验证用户头像正常显示');
await ai('验证错误提示信息不再显示');
await ai('验证登录表单已成功提交并隐藏');
```

## 错误处理测试

### 输入验证测试
```javascript
// 空值输入测试
await ai('在必填的用户名字段中不输入任何内容');
await aiTap('提交按钮');
await ai('验证显示"用户名不能为空"的错误提示');

// 格式验证测试
await ai('在邮箱字段中输入"invalid-email"');
await aiTap('提交按钮');
await ai('验证显示"邮箱格式不正确"的错误提示');
```

### 权限验证测试
```javascript
// 未授权访问测试
await ai('直接访问管理员页面URL');
await ai('验证跳转到登录页面');
await ai('验证显示"请先登录"的提示信息');
```

### 边界条件测试
```javascript
// 字符长度限制测试
await ai('在用户名字段中输入超过50个字符的文本');
await aiTap('提交按钮');
await ai('验证显示"用户名长度不能超过50个字符"的提示');
```

## 性能相关测试

### 加载时间验证
```javascript
// 虽然不能直接测试时间，但可以验证加载状态
await ai('验证页面加载动画正常显示');
await ai('等待页面内容完全加载');
await ai('验证所有图片和内容正常显示');
```

### 响应状态验证
```javascript
// 验证系统响应状态
await ai('验证操作后页面没有卡顿');
await ai('验证按钮点击后立即显示加载状态');
await ai('验证网络请求完成后正确更新页面内容');
```

## 数据一致性测试

### 表单数据验证
```javascript
// 验证表单数据持久化
await ai('填写完整表单数据');
await aiTap('保存按钮');
await ai('刷新页面');
await ai('验证表单中仍然显示之前填写的数据');
```

### 列表数据验证
```javascript
// 验证列表数据更新
await ai('记录当前列表的第一个项目');
await ai('删除列表中的第一个项目');
await ai('验证列表已更新，原第一个项目不再显示');
```

## 多平台兼容性测试

### 响应式设计验证
```javascript
// 虽然Midscene主要处理前端交互，但可以验证响应式效果
await ai('验证在当前视窗大小下页面布局正常');
await ai('验证所有文字大小合适，不会重叠');
await ai('验证按钮和链接都正常可点击');
```

## 最佳实践总结

### 测试结构
1. **准备阶段**：设置测试环境和初始状态
2. **执行阶段**：执行用户操作
3. **验证阶段**：检查操作结果
4. **清理阶段**：重置状态（如需要）

### 命名规范
- 使用描述性的测试名称
- 包含测试的功能和场景
- 使用统一的命名约定

### 维护性
- 将重复的测试步骤封装为函数
- 使用配置文件管理测试数据
- 定期更新和维护测试用例

### 调试技巧
- 使用可视化报告查看每步执行情况
- 利用Playground调试特定的测试步骤
- 检查元素定位是否准确
- 验证测试数据是否正确

## 常见问题和解决方案

### 元素定位失败
- **问题**：AI无法准确找到页面元素
- **解决方案**：提供更详细的元素描述和上下文信息

### 测试不稳定
- **问题**：相同测试在不同执行中结果不一致
- **解决方案**：拆分复杂测试为多个简单步骤，增加等待时间

### 页面加载问题
- **问题**：页面未完全加载就执行操作
- **解决方案**：增加页面加载验证步骤，使用适当等待机制

### 动态内容处理
- **问题**：页面内容动态变化导致测试失败
- **解决方案**：使用相对定位，避免依赖绝对的内容或位置